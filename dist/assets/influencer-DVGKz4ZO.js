import{s as r}from"./supabase-DgD8GzGi.js";/* empty css              */async function m(){const{data:{session:a}}=await r.auth.getSession();if(!a){window.location.href="/login.html";return}const{data:e,error:n}=await r.from("profiles").select("full_name, email, role").eq("id",a.user.id).single();if(n||!e){console.error("Profile fetch error:",n);return}let{data:t,error:o}=await r.from("influencers").select("*").eq("id",a.user.id).single();if(!t&&e.role==="influencer"){const l=(e.full_name||"USER").split(" ")[0].toUpperCase().replace(/[^A-Z]/g,"")+"VIP";console.log("New Influencer - Creating Record with code:",l);const{data:c,error:i}=await r.from("influencers").insert([{id:a.user.id,code:l,active:!0,phone:"",instagram:""}]).select().single();if(i){console.error("Auto-creation failed:",i),alert("Please ask Admin to activate your influencer account. (RLS Blocked Auto-Creation)");return}t=c}t?(document.getElementById("userInfo").innerHTML=`
            <div>
                <strong style="display:block; font-size:1.2rem; color:#fff;">${e.full_name}</strong>
                <span style="font-size:0.8rem; color:#888;">${e.email}</span>
            </div>
        `,document.getElementById("promoCode").textContent=t.code,document.getElementById("dispName").value=e.full_name||"",document.getElementById("publicEmail").value=t.public_email||e.email||"",document.getElementById("phone").value=t.phone||"",document.getElementById("imageUrl").value=t.image_url||"",document.getElementById("instagram").value=t.instagram||"",document.getElementById("facebook").value=t.facebook||"",document.getElementById("youtube").value=t.youtube||"",g(t.code)):(document.getElementById("userInfo").textContent=`User: ${e.full_name} (Not Active)`,document.getElementById("bookingsTable").innerHTML="<p>Account pending activation.</p>")}document.getElementById("saveProfileBtn").addEventListener("click",async()=>{const a=document.getElementById("saveProfileBtn"),e=document.getElementById("saveMsg");a.disabled=!0,a.textContent="Saving...",e.textContent="";const{data:{session:n}}=await r.auth.getSession();if(!n)return;const t={public_email:document.getElementById("publicEmail").value,phone:document.getElementById("phone").value,image_url:document.getElementById("imageUrl").value,instagram:document.getElementById("instagram").value,facebook:document.getElementById("facebook").value,youtube:document.getElementById("youtube").value,updated_at:new Date},{error:o}=await r.from("influencers").update(t).eq("id",n.user.id);o?(console.error("Update Error:",o),e.textContent="Error saving profile: "+o.message,e.style.color="#ff6b6b"):(e.textContent="Profile updated successfully!",e.style.color="#4cd964",setTimeout(()=>e.textContent="",3e3)),a.disabled=!1,a.textContent="Save Changes"});const d=document.getElementById("imageUpload");d&&d.addEventListener("change",async a=>{const e=a.target.files[0];if(!e)return;const n=document.getElementById("uploadStatus"),t=document.getElementById("imageUrl");n.textContent="Uploading...",n.style.color="#ffd700";try{const{data:{session:o}}=await r.auth.getSession();if(!o)throw new Error("Not logged in");const s=e.name.split(".").pop(),l=`${o.user.id}/${Date.now()}.${s}`,{data:c,error:i}=await r.storage.from("influencer-images").upload(l,e,{cacheControl:"3600",upsert:!1});if(i)throw i;const{data:{publicUrl:u}}=r.storage.from("influencer-images").getPublicUrl(l);t.value=u,n.textContent="Upload Successful! (Don't forget to click Save Changes)",n.style.color="#4caf50"}catch(o){console.error("Upload failed:",o),n.textContent="Upload Failed: "+o.message,n.style.color="#ff6b6b"}});async function g(a){const{data:e,error:n}=await r.from("bookings").select("customer_name, event_id, created_at, events(title)").eq("influencer_code",a).order("created_at",{ascending:!1}).limit(50);if(n){console.error("Error fetching bookings:",n);return}let t="<table><thead><tr><th>Date</th><th>Customer</th><th>Event Name</th></tr></thead><tbody>";e&&e.length>0?(e.forEach(o=>{const s=o.events?o.events.title:"Unknown Event";t+=`<tr>
            <td>${new Date(o.created_at).toLocaleDateString()}</td>
            <td>${o.customer_name}</td>
            <td>${s}</td>
        </tr>`}),t+="</tbody></table>"):t+="<p>No bookings yet.</p>",document.getElementById("bookingsTable").innerHTML=t,document.getElementById("totalBookings").textContent=e?e.length:0}document.getElementById("logoutBtn").addEventListener("click",async()=>{await r.auth.signOut(),window.location.href="/login.html"});m();
