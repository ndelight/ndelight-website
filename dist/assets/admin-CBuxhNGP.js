import{s as a}from"./supabase-DgD8GzGi.js";/* empty css              */let c=[];async function h(){const{data:{session:n}}=await a.auth.getSession();if(!n){window.location.href="/login.html";return}const{data:e,error:t}=await a.from("profiles").select("role, full_name, email").eq("id",n.user.id).single();if(t){console.error("Profile Fetch Error:",t),alert(`Error fetching profile:
Code: ${t.code}
Message: ${t.message}
Details: ${t.details||"None"}`);return}if(!e){alert("Profile not found. Please run the fix_profiles.sql script again.");return}if(e.role!=="admin"){alert(`Access Denied. Your role is '${e.role}', but 'admin' is required.

Please update your role in the Supabase 'profiles' table.`),window.location.href="/";return}document.getElementById("userInfo").textContent=`Logged in as: ${e.full_name||e.email}`}h();document.getElementById("logoutBtn").addEventListener("click",async()=>{await a.auth.signOut(),window.location.href="/login.html"});window.showSection=async n=>{const e=document.getElementById("dynamicContent");e.innerHTML="Loading...",n==="events"?await f(e):n==="influencers"?await u(e):n==="bookings"?await g(e):n==="pending"&&await m(e)};async function m(n){const{data:e,error:t}=await a.from("profiles").select("*").eq("role","pending_influencer");let o="<h3>Pending Influencer Applications</h3>";e&&e.length>0?(o+="<table><thead><tr><th>Name</th><th>Email</th><th>Actions</th></tr></thead><tbody>",e.forEach(i=>{o+=`<tr>
            <td>${i.full_name||"Unknown"}</td>
            <td>${i.email}</td>
            <td>
                <button class="btn-action" style="font-size:0.8rem; margin-right:10px;" onclick="window.approveInfluencer('${i.id}', '${i.full_name}', this)">Approve ✅</button>
                <button class="btn-logout" style="font-size:0.8rem;" onclick="window.rejectInfluencer('${i.id}', this)">Reject ❌</button>
            </td>
        </tr>`}),o+="</tbody></table>"):o+="<p>No pending applications.</p>",n.innerHTML=o}window.approveInfluencer=async(n,e,t)=>{if(!confirm(`Approve ${e} as an Influencer?`))return;t&&(t.disabled=!0,t.textContent="Processing...");const i=(e||"USER").split(" ")[0].toUpperCase().replace(/[^A-Z]/g,"")+"VIP",{error:l}=await a.from("influencers").insert([{id:n,code:i,active:!0}]);if(l){alert("Error creating influencer record: "+l.message),t&&(t.disabled=!1,t.textContent="Approve ✅");return}const{error:d}=await a.from("profiles").update({role:"influencer"}).eq("id",n);d?alert("Error updating profile: "+d.message):await m(document.getElementById("dynamicContent"))};window.rejectInfluencer=async(n,e)=>{if(!confirm("Reject this application? They will become a normal user."))return;e&&(e.disabled=!0,e.textContent="...");const{error:t}=await a.from("profiles").update({role:"user"}).eq("id",n);t?(alert("Error: "+t.message),e&&(e.disabled=!1,e.textContent="Reject ❌")):await m(document.getElementById("dynamicContent"))};async function f(n){const{data:e,error:t}=await a.from("events").select("*").order("date",{ascending:!0});if(t){n.innerHTML=`<p style="color:red">Error loading events: ${t.message}</p>`;return}c=e||[];let o='<h3>All Events</h3><button class="btn-action" style="margin-bottom:1rem;" onclick="window.openEventModal(null)">+ Add New Event</button>';c.length>0?(o+="<table><thead><tr><th>Title</th><th>Date</th><th>Price</th><th>Actions</th></tr></thead><tbody>",c.forEach(i=>{o+=`<tr>
            <td>${i.title}</td>
            <td>${new Date(i.date).toLocaleDateString()}</td>
            <td>₹${i.price}</td>
            <td>
                <button class="btn-action" style="font-size:0.7rem; margin-right:5px;" onclick="window.openEventModal('${i.id}')">Edit</button>
                <button class="btn-logout" style="font-size:0.7rem;" onclick="window.deleteEvent('${i.id}')">Delete</button>
            </td>
        </tr>`}),o+="</tbody></table>"):o+="<p>No events found.</p>",n.innerHTML=o}window.openEventModal=n=>{const e=document.getElementById("eventModal"),t=document.getElementById("modalTitle");if(document.getElementById("modalError").style.display="none",n){const o=c.find(l=>l.id===n);if(!o)return;t.textContent="Edit Event",document.getElementById("eventId").value=o.id,document.getElementById("evTitle").value=o.title;const i=new Date(o.date);i.setMinutes(i.getMinutes()-i.getTimezoneOffset()),document.getElementById("evDate").value=i.toISOString().slice(0,16),document.getElementById("evLocation").value=o.location||"",document.getElementById("evPrice").value=o.price||0,document.getElementById("evImage").value=o.image_url||""}else t.textContent="Add New Event",document.getElementById("eventId").value="",document.getElementById("evTitle").value="",document.getElementById("evDate").value="",document.getElementById("evLocation").value="",document.getElementById("evPrice").value="",document.getElementById("evImage").value="";e.classList.add("active")};window.closeEventModal=()=>{document.getElementById("eventModal").classList.remove("active")};window.saveEvent=async()=>{const n=document.getElementById("eventId").value,e=document.getElementById("evTitle").value,t=document.getElementById("evDate").value,o=document.getElementById("evLocation").value,i=document.getElementById("evPrice").value,l=document.getElementById("evImage").value;if(!e||!t||!i){const r=document.getElementById("modalError");r.textContent="Please fill in Title, Date and Price.",r.style.display="block";return}const d={title:e,date:new Date(t).toISOString(),location:o,price:i,image_url:l};let s;if(n?s=(await a.from("events").update(d).eq("id",n)).error:s=(await a.from("events").insert([d])).error,s){const r=document.getElementById("modalError");r.textContent="Save Error: "+s.message,r.style.display="block"}else{window.closeEventModal();const r=document.getElementById("dynamicContent");await f(r)}};window.deleteEvent=async n=>{if(!confirm("Are you sure you want to delete this event? This cannot be undone."))return;const{error:e}=await a.from("events").delete().eq("id",n);if(e)alert("Delete Failed: "+e.message);else{const t=document.getElementById("dynamicContent");await f(t)}};window.deleteInfluencer=async n=>{if(!confirm("Are you sure you want to delete this influencer? This will revoke their access."))return;const{error:e}=await a.from("influencers").delete().eq("id",n);if(e){if(e.code==="23503"&&confirm("This influencer has existing bookings and cannot be fully deleted to preserve history. Do you want to Deactivate them instead?")){await a.from("influencers").update({active:!1}).eq("id",n),alert("Influencer Deactivated."),await u(document.getElementById("dynamicContent"));return}alert("Delete Failed: "+e.message);return}await a.from("profiles").update({role:"user"}).eq("id",n),await u(document.getElementById("dynamicContent"))};async function u(n){const{data:e}=await a.from("influencers").select("*, profiles(full_name, email)");let t="<h3>Influencers</h3>";e&&e.length>0?(t+="<table><thead><tr><th>Name</th><th>Code</th><th>Active</th><th>Actions</th></tr></thead><tbody>",e.forEach(o=>{const i=o.profiles?o.profiles.full_name:"Unknown";t+=`<tr>
            <td>${i}</td>
            <td>${o.code}</td>
            <td>${o.active?"Yes":"No"}</td>
            <td>
                <button class="btn-delete" onclick="deleteInfluencer('${o.id}')">Delete</button>
            </td>
        </tr>`}),t+="</tbody></table>"):t+="<p>No influencers found.</p>",n.innerHTML=t}window.deleteBooking=async n=>{if(!confirm("Are you sure you want to delete this booking?"))return;const{error:e}=await a.from("bookings").delete().eq("id",n);e?alert("Delete Failed: "+e.message):await g(document.getElementById("dynamicContent"))};async function g(n){const{data:e}=await a.from("bookings").select("*, events(title)").order("created_at",{ascending:!1}).limit(20);let t="<h3>Recent Bookings</h3>";e&&e.length>0?(t+="<table><thead><tr><th>Customer</th><th>Event</th><th>Status</th><th>Amount</th><th>Actions</th></tr></thead><tbody>",e.forEach(o=>{const i=o.events?o.events.title:"Unknown Event";t+=`<tr>
              <td>${o.customer_name}</td>
              <td>${i}</td>
              <td>${o.status}</td>
              <td>₹${o.amount}</td>
              <td>
                  <button class="btn-delete" onclick="deleteBooking('${o.id}')">Delete</button>
              </td>
          </tr>`}),t+="</tbody></table>"):t+="<p>No bookings found.</p>",n.innerHTML=t}
