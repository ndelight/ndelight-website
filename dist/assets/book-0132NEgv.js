import{s as f}from"./supabase-DgD8GzGi.js";/* empty css              */document.addEventListener("DOMContentLoaded",()=>{const h=document.getElementById("loading-state"),u=document.getElementById("booking-card"),k=document.getElementById("back-link"),b=document.getElementById("booking-form"),n=document.getElementById("submit-btn"),y=document.getElementById("summary-title"),w=document.getElementById("summary-date"),E=document.getElementById("summary-location"),I=document.getElementById("summary-price"),p=document.getElementById("summary-total"),s=document.getElementById("tickets"),d=(()=>{const e=new URLSearchParams(window.location.search);if(e.get("id"))return e.get("id");const i=window.location.pathname.match(/\/book\/([a-zA-Z0-9-]+)/);return i?i[1]:null})();if(!d){alert("Invalid Booking URL"),window.location.href="/";return}let c=0;async function _(){try{const{data:e,error:t}=await f.from("events").select("*").eq("id",d).single();if(t||!e){console.error(t),alert("Event not found."),window.location.href="/";return}B(e)}catch(e){console.error(e),alert("Error loading event data."),window.location.href="/"}}_();function B(e){y.textContent=e.title;const t=new Date(e.date);if(w.textContent=isNaN(t)?e.date:t.toLocaleDateString("en-US",{weekday:"short",month:"long",day:"numeric",year:"numeric"}),E.textContent=e.location||"Verify via details",c=parseFloat(e.price)||0,I.textContent=c>0?`â‚¹${c}`:"Free",e.external_link){const o=document.createElement("div");o.style.marginTop="10px",o.innerHTML=`<a href="${e.external_link}" target="_blank" class="btn btn-outline" style="font-size:0.9rem; padding:8px 12px; display:inline-block; border-color:#ffd700; color:#ffd700;">View on Instagram ðŸ“¸</a>`}const i=document.querySelector(".summary-card");if(e.external_link&&i){const o=document.createElement("a");o.href=e.external_link,o.target="_blank",o.className="btn btn-outline",o.style.marginTop="1rem",o.style.width="100%",o.style.textAlign="center",o.textContent="View on Instagram ðŸ“¸",i.appendChild(o)}m(),x(),h.style.display="none",u.style.display="grid",setTimeout(()=>u.style.opacity="1",50)}function x(){k.href=`/event.html?id=${d}`}function m(){let e=parseInt(s.value)||1;e<1&&(e=1),s.value=e;const t=e*c;p.textContent=t>0?`â‚¹${t}`:"Free"}s.addEventListener("input",m),s.addEventListener("change",m),b.addEventListener("submit",async e=>{e.preventDefault();const t={name:document.getElementById("name").value,email:document.getElementById("email").value,phone:document.getElementById("phone").value},i=document.getElementById("promoCode").value.trim()||null;if((parseInt(p.textContent.replace(/[^0-9]/g,""))||0)<=0){n.textContent="Processing Free Booking...",n.disabled=!0;try{const{data:a,error:r}=await f.from("bookings").insert([{event_id:d,customer_name:t.name,customer_email:t.email,customer_phone:t.phone,amount:0,status:"paid",influencer_code:i}]).select().single();if(r)throw r;window.location.href=`/success.html?booking_id=${a.id}&payment_id=free_event`}catch(a){console.error("Free booking error:",a),alert("Booking failed. "+a.message),n.textContent="Book Ticket",n.disabled=!1}return}n.textContent="Processing Payment...",n.disabled=!0;try{const a=await fetch("/api/create-razorpay-order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event_id:d,influencer_code:i,customer_info:t})});if(!a.ok){const l=await a.json();throw new Error(l.message||"Order creation failed")}const r=await a.json(),C={key:r.key_id,amount:r.amount,currency:r.currency,name:"NDelight Events",description:y.textContent,image:"/logo.png",order_id:r.order_id,handler:function(l){window.location.href=`/success.html?booking_id=${r.booking_id}&payment_id=${l.razorpay_payment_id}`},prefill:r.prefill,theme:{color:"#ffd700"},modal:{ondismiss:function(){n.textContent="Proceed to Payment",n.disabled=!1}}},g=new Razorpay(C);g.on("payment.failed",function(l){alert("Payment Failed: "+l.error.description),n.textContent="Proceed to Payment",n.disabled=!1}),g.open()}catch(a){console.error("Booking Process Failed:",a),alert("Unable to initiate payment: "+a.message),n.textContent="Proceed to Payment",n.disabled=!1}})});
